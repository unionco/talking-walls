!function(s){var n={showDialog:function(e){e.preventDefault(),s("#mwp_woocommerce_extensions_dialog").dialog({dialogClass:"mwp-dialog",draggable:!1,resizable:!1,modal:!0,width:"700px",height:"auto",title:wpaasWooCommerceExtensions.dialogTitle,open:function(e,o){n.getExtensions()},close:function(){s(this).dialog("destroy"),window.history.replaceState&&window.history.replaceState(null,document.title,location.href.split("?")[0])}})},toggleSubmitButtonState:function(){s(".js-install-wc-extensions").attr("disabled",!s(".js-extension-checkbox:checked").length)},getExtensions:function(){s.post(ajaxurl,{action:"render_woocommerce_extensions"},function(e){var o=s(".ui-dialog-content .extensions");o.find(".preloader").remove(),e.success?(o.next().find(".js-install-wc-extensions").removeAttr("disabled"),o.html(e.data)):o.html("")})},installExtensions:function(e){e.preventDefault(),s(this).attr("disabled","disabled");var o=[],n=s(this).data("nonce");s("#mwp_woocommerce_extensions_dialog .js-extension-checkbox:checked").each(function(){s(this).hide().closest("li.plugin").addClass("installing"),s(wpaasWooCommerceExtensions.preloader).insertAfter(s(this)),o.push(s(this).data("plugin-slug"))}),o.length&&(o.forEach(function(e){s.post(ajaxurl,{action:"install_woocommerce_extensions",slug:e,_ajax_nonce:n},function(e){var o=s('.js-extension-checkbox[data-plugin-slug="'+e.data.slug+'"]'),n=e.success?'<span class="dashicons dashicons-yes install-success"></span>':'<span class="dashicons dashicons-no-alt install-error"></span>';e.success||o.closest("li.plugin").find("div.content").append('<p class="error">'+e.data.errorMessage+"</p>"),o.closest("li.plugin").removeClass("installing").find("img.loader").remove(),o.show().replaceWith(n)})}),s("#mwp_woocommerce_extensions_dialog .js-install-wc-extensions").removeAttr("disabled"))}},e=function(){var e=String(window.location).match("access_token=(.*)&expires_in"),o=null===e?"":1 in e?e[1]:"";-1<s.inArray(o,["","access_denied"])||s.ajax({method:"POST",url:ajaxurl,data:{action:"wpaas_wp_login",login_nonce:wpaasWooCommerceExtensions.wpcomNonce,access_token:decodeURIComponent(o)},async:!1,success:function(){window.location=window.location.href.split("#")[0]+"?woocommerce_extensions=1"}})},o=function(e){e.preventDefault();var o=s(this).attr("href");s.post(ajaxurl,{action:"wpaas_wp_reauth",reauth_nonce:wpaasWooCommerceExtensions.wpcomNonce},function(){window.location=o})};s(document).on("click","#mwp-view-woocommerce-extensions",n.showDialog),s(document).on("click","#mwp_woocommerce_extensions_dialog .js-extension-checkbox",n.toggleSubmitButtonState),s(document).on("click","#mwp_woocommerce_extensions_dialog .js-install-wc-extensions",n.installExtensions),s(document).on("click","#mwp_woocommerce_extensions_dialog .js-cancel-wc-extensions",function(){s("#mwp_woocommerce_extensions_dialog").dialog("destroy"),window.history.replaceState&&window.history.replaceState(null,document.title,location.href.split("?")[0])}),-1!==window.location.search.toLowerCase().indexOf("woocommerce_extensions=1")&&n.showDialog(new Event("click",{})),s(document).on("click",".js-wpaas-wpcom-reauth",o),e()}(jQuery);